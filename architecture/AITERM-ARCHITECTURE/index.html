
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AI-powered terminal optimizer for Claude Code and Gemini CLI workflows">
      
      
        <meta name="author" content="Data-Wise">
      
      
        <link rel="canonical" href="https://data-wise.github.io/aiterm/architecture/AITERM-ARCHITECTURE/">
      
      
        <link rel="prev" href="../../guides/VIDEO-WALKTHROUGH/">
      
      
        <link rel="next" href="../../reference/ARCHITECTURE/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Architecture - aiterm</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aiterm-architecture-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="aiterm" class="md-header__button md-logo" aria-label="aiterm" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            aiterm
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Data-Wise/aiterm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Data-Wise/aiterm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../QUICK-START/" class="md-tabs__link">
          
  
  
  Get Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../REFCARD/" class="md-tabs__link">
        
  
  
    
  
  Reference Card

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guide/context-detection/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/AITERM-INTEGRATION/" class="md-tabs__link">
          
  
  
  Integrations

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/commands/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/AITERM-USER-GUIDE/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="aiterm" class="md-nav__button md-logo" aria-label="aiterm" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    aiterm
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Data-Wise/aiterm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Data-Wise/aiterm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Get Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../QUICK-START/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GETTING-STARTED/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Steps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/shell-completion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shell Completion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../REFCARD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference Card
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/context-detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Profile Switching
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/terminals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terminal Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/feature-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/status-bar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Status Bar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Session Coordination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/ide-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDE Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/triggers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Triggers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/AITERM-INTEGRATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/flow-cli-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    flow-cli
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Claude Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Claude Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/claude-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-CLAUDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CLAUDE-CODE-TUTORIAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/CLAUDE-CODE-CAPABILITIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Capabilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MCP Servers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    MCP Servers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MCP-INTEGRATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-MCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    OpenCode
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    OpenCode
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-OPENCODE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/OPENCODE-AGENT-TESTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Gemini CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gemini CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gemini-cli/GEMINI_REFCARD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gemini-cli/GEMINI_TUTORIAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gemini-cli/PROMPT_ENGINEERING_ADHD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADHD Prompts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gemini-cli/WORKFLOW_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    All Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-CONTEXT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-FEATURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-HOOKS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-SESSIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-IDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDE Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/AITERM-USER-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complete User Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/GIT-WORKTREES-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git Worktrees
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/AITERM-TROUBLESHOOTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/VIDEO-WALKTHROUGH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video Walkthrough
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="System Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technology Stack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-terminal-backend-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Terminal Backend Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-context-detection-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Context Detection Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-settings-management-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Settings Management Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-cli-command-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. CLI Command Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-context-detection-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Context Detection Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-auto-approval-application-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Auto-Approval Application Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-profile-switching-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Profile Switching Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sequence-diagrams" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sequence Diagrams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sequence Diagrams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-doctor-command-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Doctor Command Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-profile-list-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Profile List Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-machines" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Machines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Machines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-context-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Context Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-settings-management-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Settings Management Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-profile-switching-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Profile Switching State
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-singleton-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Singleton Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-factory-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Factory Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-strategy-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Strategy Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-chain-of-responsibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Chain of Responsibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-template-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Template Method
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Layout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Dependencies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimization-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization Strategies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Targets
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escape-sequence-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Escape Sequence Safety
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extension-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extension Points
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extension Points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-terminal-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding New Terminal Backend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-custom-detector" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Custom Detector
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-2-additions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2 Additions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-diagrams" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Diagrams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Diagrams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-setup-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation &amp; Setup Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-recovery-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling &amp; Recovery Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-management-architecture-phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hook Management Architecture (Phase 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-template-system-phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Template System (Phase 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-server-creation-workflow-phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP Server Creation Workflow (Phase 2)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technical Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RFORGE-UNIVERSAL-BACKEND/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RForge Backend
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/AITERM-API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AITERM-IMPLEMENTATION-SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="System Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technology Stack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-terminal-backend-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Terminal Backend Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-context-detection-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Context Detection Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-settings-management-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Settings Management Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-cli-command-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. CLI Command Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-context-detection-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Context Detection Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-auto-approval-application-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Auto-Approval Application Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-profile-switching-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Profile Switching Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sequence-diagrams" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sequence Diagrams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sequence Diagrams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-doctor-command-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Doctor Command Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-profile-list-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Profile List Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-machines" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Machines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Machines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-context-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Context Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-settings-management-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Settings Management Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-profile-switching-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Profile Switching State
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-singleton-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Singleton Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-factory-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Factory Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-strategy-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Strategy Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-chain-of-responsibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Chain of Responsibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-template-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Template Method
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Layout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Dependencies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimization-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization Strategies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Targets
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escape-sequence-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Escape Sequence Safety
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extension-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extension Points
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extension Points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-terminal-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding New Terminal Backend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-custom-detector" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Custom Detector
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-2-additions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2 Additions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-diagrams" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Diagrams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Diagrams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-setup-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation &amp; Setup Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-recovery-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling &amp; Recovery Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-management-architecture-phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hook Management Architecture (Phase 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-template-system-phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Template System (Phase 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-server-creation-workflow-phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP Server Creation Workflow (Phase 2)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="aiterm-architecture-documentation">aiterm Architecture Documentation</h1>
<p><strong>Version:</strong> 0.1.0-dev
<strong>Last Updated:</strong> 2025-12-21</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#system-overview">System Overview</a></li>
<li><a href="#component-architecture">Component Architecture</a></li>
<li><a href="#data-flows">Data Flows</a></li>
<li><a href="#sequence-diagrams">Sequence Diagrams</a></li>
<li><a href="#state-machines">State Machines</a></li>
<li><a href="#design-patterns">Design Patterns</a></li>
<li><a href="#file-structure">File Structure</a></li>
</ol>
<hr />
<h2 id="system-overview">System Overview</h2>
<h3 id="high-level-architecture">High-Level Architecture</h3>
<pre class="mermaid"><code>graph TB
    subgraph "User Interface"
        CLI[CLI Layer&lt;br/&gt;Typer]
    end

    subgraph "Core Library"
        Terminal[Terminal Backend&lt;br/&gt;Abstraction]
        Context[Context Detection&lt;br/&gt;Engine]
        Settings[Settings Manager]
    end

    subgraph "Integrations"
        ITerm2[iTerm2&lt;br/&gt;Integration]
        Claude[Claude Code&lt;br/&gt;Integration]
        MCP[MCP Server&lt;br/&gt;Management]
    end

    CLI --&gt; Terminal
    CLI --&gt; Context
    CLI --&gt; Settings

    Terminal --&gt; ITerm2
    Settings --&gt; Claude
    Settings --&gt; MCP

    Context --&gt; Terminal
    Context -.-&gt; Claude</code></pre>
<p><strong>Key Components:</strong>
- <strong>CLI Layer</strong> - User-facing commands (Typer framework)
- <strong>Terminal Backend</strong> - Abstracted terminal operations
- <strong>Context Detection</strong> - Project type detection
- <strong>Settings Manager</strong> - Configuration management
- <strong>Integrations</strong> - iTerm2, Claude Code, MCP servers</p>
<hr />
<h3 id="technology-stack">Technology Stack</h3>
<pre class="mermaid"><code>graph LR
    subgraph "Runtime"
        Python[Python 3.10+]
    end

    subgraph "CLI Framework"
        Typer[Typer&lt;br/&gt;CLI framework]
        Rich[Rich&lt;br/&gt;Terminal output]
        Quest[Questionary&lt;br/&gt;Interactive prompts]
    end

    subgraph "Build &amp; Distribution"
        UV[UV&lt;br/&gt;Package manager]
        Hatchling[Hatchling&lt;br/&gt;Build backend]
    end

    subgraph "Testing"
        Pytest[pytest&lt;br/&gt;Test framework]
        Coverage[pytest-cov&lt;br/&gt;Coverage]
    end

    Python --&gt; Typer
    Python --&gt; Rich
    Python --&gt; Quest
    Python --&gt; UV
    UV --&gt; Hatchling
    Python --&gt; Pytest</code></pre>
<hr />
<h2 id="component-architecture">Component Architecture</h2>
<h3 id="1-terminal-backend-architecture">1. Terminal Backend Architecture</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Terminal Backend"
        Base[TerminalBackend&lt;br/&gt;Abstract Base Class]
        ITerm2[iTerm2Terminal&lt;br/&gt;Implementation]
        Wezterm[WeztermTerminal&lt;br/&gt;Future]
        Alacritty[AlacrittyTerminal&lt;br/&gt;Future]

        Base -.-&gt; ITerm2
        Base -.-&gt; Wezterm
        Base -.-&gt; Alacritty
    end

    subgraph "Operations"
        Profile[switch_profile]
        Title[set_title]
        Status[set_status_var]
        Query[get_current_profile]
    end

    ITerm2 --&gt; Profile
    ITerm2 --&gt; Title
    ITerm2 --&gt; Status
    ITerm2 --&gt; Query

    subgraph "iTerm2 Integration"
        Escape[Escape Sequences]
        API[Python API&lt;br/&gt;Future]
    end

    ITerm2 --&gt; Escape
    ITerm2 -.-&gt; API</code></pre>
<p><strong>Design Pattern:</strong> Abstract Factory + Strategy</p>
<p><strong>Key Abstractions:</strong>
- <code>TerminalBackend</code> - Base interface for all terminals
- <code>iTerm2Terminal</code> - iTerm2-specific implementation
- Future: Wezterm, Alacritty, Kitty support</p>
<hr />
<h3 id="2-context-detection-architecture">2. Context Detection Architecture</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Context Detection Engine"
        Detector[ContextDetector&lt;br/&gt;Base Class]
        Registry[DetectorRegistry&lt;br/&gt;Singleton]
    end

    subgraph "Built-in Detectors"
        Prod[ProductionDetector&lt;br/&gt;Priority: 1]
        AI[AISessionDetector&lt;br/&gt;Priority: 2]
        R[RPackageDetector&lt;br/&gt;Priority: 3]
        Py[PythonDetector&lt;br/&gt;Priority: 4]
        Node[NodeDetector&lt;br/&gt;Priority: 5]
        Quarto[QuartoDetector&lt;br/&gt;Priority: 6]
        MCP[MCPDetector&lt;br/&gt;Priority: 7]
        Dev[DevToolsDetector&lt;br/&gt;Priority: 8]
        Default[DefaultDetector&lt;br/&gt;Priority: 9]
    end

    subgraph "Custom Detectors"
        Custom[User-Defined&lt;br/&gt;Detectors]
    end

    Registry --&gt; Prod
    Registry --&gt; AI
    Registry --&gt; R
    Registry --&gt; Py
    Registry --&gt; Node
    Registry --&gt; Quarto
    Registry --&gt; MCP
    Registry --&gt; Dev
    Registry --&gt; Default
    Registry -.-&gt; Custom

    Detector &lt;.. Prod
    Detector &lt;.. AI
    Detector &lt;.. R
    Detector &lt;.. Custom</code></pre>
<p><strong>Design Pattern:</strong> Chain of Responsibility + Priority Queue</p>
<p><strong>Detection Flow:</strong>
1. User calls <code>detect_context(path)</code>
2. Registry iterates detectors by priority
3. First detector that returns non-null wins
4. Return <code>Context</code> object with profile, title, metadata</p>
<hr />
<h3 id="3-settings-management-architecture">3. Settings Management Architecture</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Settings Manager"
        Manager[SettingsManager&lt;br/&gt;Singleton]
        Validator[ConfigValidator]
        Backup[BackupManager]
    end

    subgraph "Configuration Files"
        Aiterm[~/.aiterm/config.json]
        Claude[~/.claude/settings.json]
    end

    subgraph "Operations"
        Read[read_settings]
        Write[write_settings]
        Validate[validate_config]
        Apply[apply_preset]
    end

    Manager --&gt; Read
    Manager --&gt; Write
    Manager --&gt; Validate
    Manager --&gt; Apply

    Read --&gt; Aiterm
    Read --&gt; Claude
    Write --&gt; Aiterm
    Write --&gt; Claude
    Validate --&gt; Validator
    Write --&gt; Backup

    Backup -.-&gt; Claude</code></pre>
<p><strong>Design Pattern:</strong> Singleton + Template Method</p>
<p><strong>Key Features:</strong>
- Automatic backups before writes
- JSON validation
- Preset management (8 presets)
- Merge strategies (replace vs merge)</p>
<hr />
<h3 id="4-cli-command-architecture">4. CLI Command Architecture</h3>
<pre class="mermaid"><code>graph TB
    subgraph "CLI Entry Point"
        Main[aiterm&lt;br/&gt;Main Command]
    end

    subgraph "Command Groups"
        Core[Core Commands&lt;br/&gt;doctor, detect]
        Profile[Profile Commands&lt;br/&gt;list, switch]
        Claude[Claude Commands&lt;br/&gt;approvals, settings]
        MCP[MCP Commands&lt;br/&gt;list, test, validate]
    end

    subgraph "Command Implementation"
        Handler[Command Handler]
        Validator[Input Validator]
        Output[Output Formatter&lt;br/&gt;Rich]
    end

    Main --&gt; Core
    Main --&gt; Profile
    Main --&gt; Claude
    Main -.-&gt; MCP

    Core --&gt; Handler
    Profile --&gt; Handler
    Claude --&gt; Handler

    Handler --&gt; Validator
    Handler --&gt; Output</code></pre>
<p><strong>Design Pattern:</strong> Command Pattern + Decorator</p>
<p><strong>Command Structure:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">doctor</span><span class="p">():</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check aiterm installation&quot;&quot;&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="c1"># 1. Validate environment</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="c1"># 2. Check dependencies</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="c1"># 3. Format output (Rich)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="c1"># 4. Return exit code</span>
</code></pre></div></p>
<hr />
<h2 id="data-flows">Data Flows</h2>
<h3 id="1-context-detection-flow">1. Context Detection Flow</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Detector
    participant Terminal
    participant iTerm2

    User-&gt;&gt;CLI: cd ~/projects/RMediation
    activate CLI

    CLI-&gt;&gt;Detector: detect_context(pwd)
    activate Detector

    Detector-&gt;&gt;Detector: Check DESCRIPTION file
    Detector-&gt;&gt;Detector: Check R/ directory
    Detector-&gt;&gt;Detector: Parse package name/version

    Detector--&gt;&gt;CLI: Context(type=r-package, profile=R-Dev)
    deactivate Detector

    CLI-&gt;&gt;Terminal: switch_profile("R-Dev")
    activate Terminal
    Terminal-&gt;&gt;iTerm2: ESC]1337;SetProfile=R-Dev
    iTerm2--&gt;&gt;Terminal: Profile switched
    deactivate Terminal

    CLI-&gt;&gt;Terminal: set_title("RMediation v1.0.0")
    activate Terminal
    Terminal-&gt;&gt;iTerm2: ESC]0;RMediation v1.0.0
    iTerm2--&gt;&gt;Terminal: Title set
    deactivate Terminal

    CLI-&gt;&gt;Terminal: set_status_var("project_type", "R PKG")
    activate Terminal
    Terminal-&gt;&gt;iTerm2: ESC]1337;SetUserVar=...
    iTerm2--&gt;&gt;Terminal: Variable set
    deactivate Terminal

    CLI--&gt;&gt;User: Context switched 
    deactivate CLI</code></pre>
<p><strong>Performance:</strong>
- Detection: &lt; 50ms
- Profile switch: &lt; 150ms
- Total: &lt; 200ms</p>
<hr />
<h3 id="2-auto-approval-application-flow">2. Auto-Approval Application Flow</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Settings
    participant Backup
    participant Claude

    User-&gt;&gt;CLI: aiterm claude approvals set r-package
    activate CLI

    CLI-&gt;&gt;Settings: read_claude_settings()
    activate Settings
    Settings-&gt;&gt;Claude: Read ~/.claude/settings.json
    Claude--&gt;&gt;Settings: Current settings
    Settings--&gt;&gt;CLI: settings dict
    deactivate Settings

    CLI-&gt;&gt;Backup: create_backup(settings)
    activate Backup
    Backup-&gt;&gt;Claude: Write ~/.claude/settings.json.backup.TIMESTAMP
    Backup--&gt;&gt;CLI: Backup created
    deactivate Backup

    CLI-&gt;&gt;Settings: apply_approval_preset("r-package")
    activate Settings
    Settings-&gt;&gt;Settings: Load r-package preset (35 tools)
    Settings-&gt;&gt;Settings: Merge with current approvals
    Settings-&gt;&gt;Settings: Validate JSON structure
    Settings--&gt;&gt;CLI: Updated settings
    deactivate Settings

    CLI-&gt;&gt;Settings: write_claude_settings(updated)
    activate Settings
    Settings-&gt;&gt;Claude: Write ~/.claude/settings.json
    Claude--&gt;&gt;Settings: Write complete
    Settings--&gt;&gt;CLI: Success
    deactivate Settings

    CLI--&gt;&gt;User:  Applied r-package preset (35 tools)
    deactivate CLI</code></pre>
<p><strong>Safety Features:</strong>
- Automatic backup before write
- JSON validation
- Rollback on error
- Backup retention (last 5)</p>
<hr />
<h3 id="3-profile-switching-flow">3. Profile Switching Flow</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Terminal
    participant iTerm2
    participant Shell

    User-&gt;&gt;CLI: aiterm profile switch R-Dev
    activate CLI

    CLI-&gt;&gt;Terminal: get_terminal()
    activate Terminal
    Terminal-&gt;&gt;Terminal: Detect terminal type
    Terminal--&gt;&gt;CLI: iTerm2Terminal instance
    deactivate Terminal

    CLI-&gt;&gt;Terminal: switch_profile("R-Dev")
    activate Terminal

    Terminal-&gt;&gt;Terminal: Validate profile exists
    Terminal-&gt;&gt;iTerm2: Send escape sequence&lt;br/&gt;ESC]1337;SetProfile=R-Dev BEL
    iTerm2-&gt;&gt;iTerm2: Switch profile
    iTerm2-&gt;&gt;Shell: Update environment
    iTerm2--&gt;&gt;Terminal: Profile switched

    Terminal--&gt;&gt;CLI: Success
    deactivate Terminal

    CLI-&gt;&gt;Terminal: set_title("R Development")
    activate Terminal
    Terminal-&gt;&gt;iTerm2: ESC]0;R Development BEL
    iTerm2--&gt;&gt;Terminal: Title set
    deactivate Terminal

    CLI--&gt;&gt;User:  Switched to R-Dev
    deactivate CLI</code></pre>
<hr />
<h2 id="sequence-diagrams">Sequence Diagrams</h2>
<h3 id="4-doctor-command-flow">4. Doctor Command Flow</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Checks
    participant System

    User-&gt;&gt;CLI: aiterm doctor
    activate CLI

    CLI-&gt;&gt;Checks: check_python_version()
    activate Checks
    Checks-&gt;&gt;System: python --version
    System--&gt;&gt;Checks: 3.11.5
    Checks--&gt;&gt;CLI:  Python 3.11.5
    deactivate Checks

    CLI-&gt;&gt;Checks: check_terminal()
    activate Checks
    Checks-&gt;&gt;System: $TERM_PROGRAM
    System--&gt;&gt;Checks: iTerm.app
    Checks-&gt;&gt;System: iTerm2 version
    System--&gt;&gt;Checks: Build 3.5.0
    Checks--&gt;&gt;CLI:  iTerm2 (Build 3.5.0)
    deactivate Checks

    CLI-&gt;&gt;Checks: check_claude_code()
    activate Checks
    Checks-&gt;&gt;System: ~/.claude/ exists?
    System--&gt;&gt;Checks: Yes
    Checks-&gt;&gt;System: claude --version
    System--&gt;&gt;Checks: 0.2.0
    Checks--&gt;&gt;CLI:  Claude Code 0.2.0
    deactivate Checks

    CLI-&gt;&gt;Checks: check_config()
    activate Checks
    Checks-&gt;&gt;System: ~/.aiterm/config.json exists?
    System--&gt;&gt;Checks: Yes
    Checks-&gt;&gt;System: Validate JSON
    System--&gt;&gt;Checks: Valid
    Checks--&gt;&gt;CLI:  Settings OK
    deactivate Checks

    CLI--&gt;&gt;User: All checks passed! 
    deactivate CLI</code></pre>
<hr />
<h3 id="5-profile-list-flow">5. Profile List Flow</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Terminal
    participant Config

    User-&gt;&gt;CLI: aiterm profile list
    activate CLI

    CLI-&gt;&gt;Config: read_config()
    activate Config
    Config-&gt;&gt;Config: Load ~/.aiterm/config.json
    Config--&gt;&gt;CLI: Config dict
    deactivate Config

    CLI-&gt;&gt;Terminal: get_available_profiles()
    activate Terminal
    Terminal-&gt;&gt;Config: profiles section
    Terminal-&gt;&gt;Terminal: Parse profile definitions
    Terminal--&gt;&gt;CLI: List of profiles
    deactivate Terminal

    loop For each profile
        CLI-&gt;&gt;CLI: Format profile info
        CLI-&gt;&gt;CLI: Add theme, triggers, description
    end

    CLI--&gt;&gt;User: Display formatted profile list
    deactivate CLI</code></pre>
<hr />
<h2 id="state-machines">State Machines</h2>
<h3 id="1-context-lifecycle">1. Context Lifecycle</h3>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; Unknown: Start
    Unknown --&gt; Detected: Context found
    Unknown --&gt; Unknown: No context
    Detected --&gt; Switched: Apply profile
    Switched --&gt; Active: Profile applied
    Active --&gt; Detected: Directory change
    Active --&gt; [*]: Exit terminal</code></pre>
<p><strong>States:</strong>
- <strong>Unknown</strong> - No context detected
- <strong>Detected</strong> - Context identified
- <strong>Switched</strong> - Profile switching in progress
- <strong>Active</strong> - Profile active and in use</p>
<hr />
<h3 id="2-settings-management-lifecycle">2. Settings Management Lifecycle</h3>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; Unloaded
    Unloaded --&gt; Loading: Read request
    Loading --&gt; Loaded: Success
    Loading --&gt; Error: Parse fail
    Loaded --&gt; Modifying: Update request
    Modifying --&gt; Validating: Changes made
    Validating --&gt; BackingUp: Validation passed
    Validating --&gt; Error: Validation failed
    BackingUp --&gt; Writing: Backup created
    Writing --&gt; Loaded: Write success
    Writing --&gt; Error: Write fail
    Error --&gt; Loaded: Rollback
    Loaded --&gt; [*]: Session end</code></pre>
<p><strong>States:</strong>
- <strong>Unloaded</strong> - Settings not read
- <strong>Loading</strong> - Reading from disk
- <strong>Loaded</strong> - Settings in memory
- <strong>Modifying</strong> - Changes being made
- <strong>Validating</strong> - Checking validity
- <strong>BackingUp</strong> - Creating backup
- <strong>Writing</strong> - Writing to disk
- <strong>Error</strong> - Error state (with rollback)</p>
<hr />
<h3 id="3-profile-switching-state">3. Profile Switching State</h3>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; Idle
    Idle --&gt; Detecting: cd command
    Detecting --&gt; Matched: Context found
    Detecting --&gt; Idle: No match
    Matched --&gt; Switching: Profile selected
    Switching --&gt; Applied: Escape sequence sent
    Switching --&gt; Failed: Terminal error
    Applied --&gt; Updating: Set title/vars
    Updating --&gt; Idle: Complete
    Failed --&gt; Idle: Fallback to default</code></pre>
<hr />
<h2 id="design-patterns">Design Patterns</h2>
<h3 id="1-singleton-pattern">1. Singleton Pattern</h3>
<p><strong>Used For:</strong> Settings Manager, Detector Registry</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SettingsManager</span><span class="p">:</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>            <span class="k">return</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_settings</span><span class="p">()</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
<p><strong>Why:</strong> Single source of truth for settings</p>
<hr />
<h3 id="2-factory-pattern">2. Factory Pattern</h3>
<p><strong>Used For:</strong> Terminal backend creation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_terminal</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TerminalBackend</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory function for terminal backends&quot;&quot;&quot;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">term_program</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;TERM_PROGRAM&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="k">if</span> <span class="s2">&quot;iTerm&quot;</span> <span class="ow">in</span> <span class="n">term_program</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        <span class="k">return</span> <span class="n">iTerm2Terminal</span><span class="p">()</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="k">elif</span> <span class="s2">&quot;WezTerm&quot;</span> <span class="ow">in</span> <span class="n">term_program</span><span class="p">:</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>        <span class="k">return</span> <span class="n">WeztermTerminal</span><span class="p">()</span>  <span class="c1"># Future</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="k">return</span> <span class="n">DefaultTerminal</span><span class="p">()</span>  <span class="c1"># Fallback</span>
</code></pre></div>
<p><strong>Why:</strong> Abstract terminal selection</p>
<hr />
<h3 id="3-strategy-pattern">3. Strategy Pattern</h3>
<p><strong>Used For:</strong> Context detection</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ContextDetector</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect context from path&quot;&quot;&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="k">pass</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">RPackageDetector</span><span class="p">(</span><span class="n">ContextDetector</span><span class="p">):</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">):</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>            <span class="c1"># R package logic</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p><strong>Why:</strong> Pluggable detection strategies</p>
<hr />
<h3 id="4-chain-of-responsibility">4. Chain of Responsibility</h3>
<p><strong>Used For:</strong> Detector priority chain</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DetectorRegistry</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="c1"># Try detectors in priority order</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>        <span class="k">for</span> <span class="n">detector</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detectors</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">priority</span><span class="p">):</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>            <span class="n">context</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>                <span class="k">return</span> <span class="n">context</span>  <span class="c1"># First match wins</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No matches</span>
</code></pre></div>
<p><strong>Why:</strong> First-match-wins with priority</p>
<hr />
<h3 id="5-template-method">5. Template Method</h3>
<p><strong>Used For:</strong> Settings operations</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SettingsManager</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="c1"># Template method</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_settings</span><span class="p">()</span>       <span class="c1"># 1. Read</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backup_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>        <span class="c1"># 2. Backup</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_preset</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">preset_name</span><span class="p">)</span>  <span class="c1"># 3. Merge</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate_settings</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>       <span class="c1"># 4. Validate</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_settings</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>          <span class="c1"># 5. Write</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_merge_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">preset</span><span class="p">):</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="c1"># Subclass hook (override for custom merge)</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        <span class="k">pass</span>
</code></pre></div>
<p><strong>Why:</strong> Consistent operation flow</p>
<hr />
<h2 id="file-structure">File Structure</h2>
<h3 id="project-layout">Project Layout</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>aiterm/
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a> src/aiterm/              # Main package
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    __init__.py
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    cli/                 # CLI commands
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>       __init__.py
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>       main.py          # Entry point
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>       core.py          # doctor, detect
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>       profile.py       # profile commands
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>       claude.py        # Claude Code commands
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>       mcp.py           # MCP commands (future)
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    terminal/            # Terminal backends
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>       __init__.py
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>       base.py          # Abstract base
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>       iterm2.py        # iTerm2 implementation
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>       wezterm.py       # Wezterm (future)
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>       detector.py      # Terminal detection
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    context/             # Context detection
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>       __init__.py
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>       base.py          # Abstract detector
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>       registry.py      # Detector registry
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>       detectors/       # Built-in detectors
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>          production.py
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>          ai_session.py
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>          r_package.py
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>          python.py
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>          nodejs.py
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>          quarto.py
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>          mcp.py
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>          dev_tools.py
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>       types.py         # Context type definitions
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>    claude/              # Claude Code integration
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>       __init__.py
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>       settings.py      # Settings management
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>       presets.py       # Auto-approval presets
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>       hooks.py         # Hook management (future)
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>       commands.py      # Command templates (future)
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    utils/               # Utilities
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>       __init__.py
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>       config.py        # Config file handling
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>       shell.py         # Shell integration
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>       exceptions.py    # Custom exceptions
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>    version.py           # Version info
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a> templates/               # User-facing templates
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>    profiles/            # iTerm2 profile JSON
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>       R-Dev.json
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>       Python-Dev.json
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>       ...
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>    hooks/               # Hook templates (future)
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>    commands/            # Command templates (future)
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a> tests/                   # Test suite
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>    unit/
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>    integration/
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>    fixtures/
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a> docs/                    # Documentation
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>    api/
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>    architecture/
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>    guides/
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>    troubleshooting/
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a> pyproject.toml           # Project config
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a> README.md
</code></pre></div>
<hr />
<h3 id="module-dependencies">Module Dependencies</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Public API"
        CLI[cli/]
    end

    subgraph "Core Library"
        Terminal[terminal/]
        Context[context/]
        Settings[claude/]
        Utils[utils/]
    end

    CLI --&gt; Terminal
    CLI --&gt; Context
    CLI --&gt; Settings

    Terminal --&gt; Utils
    Context --&gt; Utils
    Settings --&gt; Utils

    Context -.-&gt; Terminal</code></pre>
<p><strong>Dependency Rules:</strong>
- CLI depends on Core Library
- Core Library is self-contained
- Utils are leaf modules (no dependencies)
- Context may trigger Terminal operations
- No circular dependencies</p>
<hr />
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="optimization-strategies">Optimization Strategies</h3>
<ol>
<li><strong>Lazy Loading</strong></li>
<li>Load detectors on-demand</li>
<li>Cache detector results</li>
<li>
<p>Lazy import heavy modules</p>
</li>
<li>
<p><strong>Caching</strong></p>
</li>
<li>Cache context detection results</li>
<li>Cache settings reads (TTL: 5s)</li>
<li>
<p>Cache terminal type detection</p>
</li>
<li>
<p><strong>Async Operations</strong> (Future)</p>
</li>
<li>Parallel detector execution</li>
<li>Async file I/O</li>
<li>Non-blocking profile switching</li>
</ol>
<hr />
<h3 id="performance-targets">Performance Targets</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Target</th>
<th>Current</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Context detection</td>
<td>&lt; 50ms</td>
<td>~30ms</td>
<td></td>
</tr>
<tr>
<td>Profile switching</td>
<td>&lt; 150ms</td>
<td>~100ms</td>
<td></td>
</tr>
<tr>
<td>Settings read</td>
<td>&lt; 10ms</td>
<td>~5ms</td>
<td></td>
</tr>
<tr>
<td>Settings write</td>
<td>&lt; 50ms</td>
<td>~40ms</td>
<td></td>
</tr>
<tr>
<td>Doctor check</td>
<td>&lt; 200ms</td>
<td>~150ms</td>
<td></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="security-considerations">Security Considerations</h2>
<h3 id="file-permissions">File Permissions</h3>
<ul>
<li><code>~/.aiterm/config.json</code> - 600 (user read/write only)</li>
<li><code>~/.claude/settings.json</code> - 600 (user read/write only)</li>
<li>Backups - 600 (user read/write only)</li>
</ul>
<h3 id="input-validation">Input Validation</h3>
<ul>
<li>Profile names - Alphanumeric + dashes</li>
<li>Paths - Absolute paths only, no symlink following</li>
<li>Settings - JSON schema validation</li>
<li>Presets - Whitelist of known presets</li>
</ul>
<h3 id="escape-sequence-safety">Escape Sequence Safety</h3>
<ul>
<li>No user input in escape sequences (XSS risk)</li>
<li>Whitelist of allowed sequences</li>
<li>Sanitize all title/variable values</li>
</ul>
<hr />
<h2 id="extension-points">Extension Points</h2>
<h3 id="adding-new-terminal-backend">Adding New Terminal Backend</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aiterm.terminal.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">TerminalBackend</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyTerminal</span><span class="p">(</span><span class="n">TerminalBackend</span><span class="p">):</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">switch_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>        <span class="c1"># Custom implementation</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>        <span class="k">pass</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="c1"># Custom implementation</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="k">pass</span>
</code></pre></div>
<h3 id="adding-custom-detector">Adding Custom Detector</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aiterm.context.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContextDetector</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aiterm.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_detector</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyDetector</span><span class="p">(</span><span class="n">ContextDetector</span><span class="p">):</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">priority</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="c1"># Custom logic</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        <span class="k">pass</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">register_detector</span><span class="p">(</span><span class="n">MyDetector</span><span class="p">())</span>
</code></pre></div>
<hr />
<h2 id="future-architecture">Future Architecture</h2>
<h3 id="phase-2-additions">Phase 2 Additions</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Phase 2"
        Hook[Hook Manager]
        MCP[MCP Creator]
        Plugin[Plugin System]
    end

    subgraph "Existing"
        CLI[CLI]
        Terminal[Terminal]
        Context[Context]
    end

    CLI -.-&gt; Hook
    CLI -.-&gt; MCP
    CLI -.-&gt; Plugin

    Hook -.-&gt; Terminal
    MCP -.-&gt; Context</code></pre>
<p><strong>Planned Features:</strong>
- Hook management system
- MCP server creation wizard
- Plugin architecture
- Remote terminal support
- Web UI</p>
<hr />
<h2 id="additional-diagrams">Additional Diagrams</h2>
<h3 id="installation-setup-flow">Installation &amp; Setup Flow</h3>
<pre class="mermaid"><code>flowchart TD
    Start([User installs aiterm]) --&gt; Install{Installation&lt;br/&gt;Method?}

    Install --&gt;|Homebrew| Brew[brew install data-wise/tap/aiterm]
    Install --&gt;|UV| UV[uv tool install git+...]
    Install --&gt;|pipx| Pipx[pipx install git+...]

    Brew --&gt; Verify
    UV --&gt; Verify
    Pipx --&gt; Verify

    Verify[aiterm doctor] --&gt; Check{All checks&lt;br/&gt;passed?}

    Check --&gt;|No| Fix[Fix issues]
    Fix --&gt; Verify

    Check --&gt;|Yes| Detect[aiterm detect]
    Detect --&gt; Context{Context&lt;br/&gt;detected?}

    Context --&gt;|Yes| Auto[Auto-switching enabled]
    Context --&gt;|No| Manual[Manual profile selection]

    Auto --&gt; ListProfiles[aiterm profile list]
    Manual --&gt; ListProfiles

    ListProfiles --&gt; SetApprovals[aiterm claude approvals set]
    SetApprovals --&gt; Done([Setup Complete])

    style Start fill:#e1f5e1
    style Done fill:#e1f5e1
    style Check fill:#fff4e6
    style Context fill:#fff4e6</code></pre>
<p><strong>User Journey:</strong>
1. Install via preferred method (Homebrew/UV/pipx)
2. Run <code>aiterm doctor</code> to verify installation
3. Fix any issues identified
4. Test context detection with <code>aiterm detect</code>
5. Review available profiles
6. Set auto-approval presets for Claude Code
7. Begin using aiterm!</p>
<hr />
<h3 id="error-handling-recovery-flow">Error Handling &amp; Recovery Flow</h3>
<pre class="mermaid"><code>flowchart TD
    Operation[User Operation] --&gt; Try{Try&lt;br/&gt;Operation}

    Try --&gt;|Success| Log[Log success]
    Try --&gt;|Error| Catch[Catch Exception]

    Catch --&gt; ErrorType{Error&lt;br/&gt;Type?}

    ErrorType --&gt;|ProfileNotFound| PNF[Profile not found error]
    ErrorType --&gt;|TerminalUnsupported| TU[Terminal unsupported]
    ErrorType --&gt;|PermissionDenied| PD[Permission denied]
    ErrorType --&gt;|ConfigError| CE[Config error]
    ErrorType --&gt;|Other| OE[General error]

    PNF --&gt; Recover1{Recovery&lt;br/&gt;Available?}
    TU --&gt; Recover2{Fallback&lt;br/&gt;Available?}
    PD --&gt; Recover3{Fix&lt;br/&gt;Permissions?}
    CE --&gt; Recover4{Restore&lt;br/&gt;Backup?}
    OE --&gt; Recover5{Retry?}

    Recover1 --&gt;|Yes| DefaultProfile[Use default profile]
    Recover1 --&gt;|No| UserError1[Show error to user]

    Recover2 --&gt;|Yes| ReducedFeatures[Operate with reduced features]
    Recover2 --&gt;|No| UserError2[Explain limitation]

    Recover3 --&gt;|Yes| FixPerms[chmod 600 config files]
    Recover3 --&gt;|No| UserError3[Guide user to fix]

    Recover4 --&gt;|Yes| Rollback[Restore from backup]
    Recover4 --&gt;|No| UserError4[Show validation errors]

    Recover5 --&gt;|Yes| Retry[Retry operation]
    Recover5 --&gt;|No| UserError5[Show error details]

    DefaultProfile --&gt; Log
    ReducedFeatures --&gt; Log
    FixPerms --&gt; Retry
    Rollback --&gt; Retry
    Retry --&gt; Try

    UserError1 --&gt; Exit
    UserError2 --&gt; Exit
    UserError3 --&gt; Exit
    UserError4 --&gt; Exit
    UserError5 --&gt; Exit

    Log --&gt; Success([Operation Complete])

    Exit([Exit with error code])

    style Operation fill:#e1f5e1
    style Success fill:#e1f5e1
    style Exit fill:#ffe1e1
    style ErrorType fill:#fff4e6</code></pre>
<p><strong>Error Handling Strategy:</strong>
- <strong>Graceful Degradation</strong> - Fallback to reduced features when possible
- <strong>Automatic Recovery</strong> - Retry with defaults when sensible
- <strong>Backup &amp; Rollback</strong> - All settings changes backed up
- <strong>Clear Messaging</strong> - User-friendly error messages with solutions
- <strong>Exit Codes</strong> - Consistent error codes for scripting</p>
<hr />
<h3 id="hook-management-architecture-phase-2">Hook Management Architecture (Phase 2)</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Hook System"
        HookMgr[Hook Manager]
        HookRegistry[Hook Registry]
        HookExecutor[Hook Executor]
    end

    subgraph "Hook Types"
        PreCD[Pre-CD Hook&lt;br/&gt;Before directory change]
        PostCD[Post-CD Hook&lt;br/&gt;After directory change]
        PreSwitch[Pre-Switch Hook&lt;br/&gt;Before profile switch]
        PostSwitch[Post-Switch Hook&lt;br/&gt;After profile switch]
        PreApproval[Pre-Approval Hook&lt;br/&gt;Before setting approvals]
        PostApproval[Post-Approval Hook&lt;br/&gt;After setting approvals]
    end

    subgraph "Hook Templates"
        T1[Notification Hook]
        T2[Logging Hook]
        T3[Validation Hook]
        T4[Integration Hook]
    end

    subgraph "User Hooks"
        U1[~/.claude/hooks/pre-cd.sh]
        U2[~/.claude/hooks/post-cd.sh]
        U3[Custom Hook Scripts]
    end

    HookMgr --&gt; HookRegistry
    HookMgr --&gt; HookExecutor

    HookRegistry --&gt; PreCD
    HookRegistry --&gt; PostCD
    HookRegistry --&gt; PreSwitch
    HookRegistry --&gt; PostSwitch
    HookRegistry --&gt; PreApproval
    HookRegistry --&gt; PostApproval

    HookExecutor --&gt; T1
    HookExecutor --&gt; T2
    HookExecutor --&gt; T3
    HookExecutor --&gt; T4

    PreCD --&gt; U1
    PostCD --&gt; U2
    PostSwitch --&gt; U3

    style HookMgr fill:#e3f2fd
    style HookExecutor fill:#e3f2fd</code></pre>
<p><strong>Hook Capabilities (Phase 2):</strong>
- <strong>Event-Driven</strong> - React to context changes
- <strong>Template Library</strong> - Pre-built common hooks
- <strong>User Scripts</strong> - Custom bash/python scripts
- <strong>Validation</strong> - Pre-execution validation
- <strong>Error Handling</strong> - Graceful failure handling</p>
<p><strong>Example Hooks:</strong>
- Send Slack notification on production context
- Log all profile switches to audit file
- Validate Claude Code settings before applying
- Trigger git status on project context switch</p>
<hr />
<h3 id="command-template-system-phase-2">Command Template System (Phase 2)</h3>
<pre class="mermaid"><code>graph TB
    subgraph "Template Engine"
        TEngine[Template Engine]
        TRegistry[Template Registry]
        TRenderer[Template Renderer]
    end

    subgraph "Built-in Templates"
        Git[Git Commands&lt;br/&gt;commit, status, log]
        Test[Test Commands&lt;br/&gt;pytest, R CMD check]
        Build[Build Commands&lt;br/&gt;quarto render, npm build]
        Deploy[Deploy Commands&lt;br/&gt;gh-pages, vercel]
        Claude[Claude Commands&lt;br/&gt;/done, /recap, /next]
    end

    subgraph "Template Variables"
        V1[{{project_name}}]
        V2[{{project_type}}]
        V3[{{git_branch}}]
        V4[{{current_profile}}]
        V5[{{context_metadata}}]
    end

    subgraph "User Templates"
        UT1[~/.claude/commands/my-workflow.md]
        UT2[~/.claude/commands/test-all.md]
        UT3[Custom Command Templates]
    end

    TEngine --&gt; TRegistry
    TEngine --&gt; TRenderer

    TRegistry --&gt; Git
    TRegistry --&gt; Test
    TRegistry --&gt; Build
    TRegistry --&gt; Deploy
    TRegistry --&gt; Claude

    TRenderer --&gt; V1
    TRenderer --&gt; V2
    TRenderer --&gt; V3
    TRenderer --&gt; V4
    TRenderer --&gt; V5

    Git --&gt; UT1
    Test --&gt; UT2
    Deploy --&gt; UT3

    style TEngine fill:#fff3e0
    style TRenderer fill:#fff3e0</code></pre>
<p><strong>Template Features (Phase 2):</strong>
- <strong>Context-Aware</strong> - Auto-fill variables from current context
- <strong>Composable</strong> - Combine multiple templates
- <strong>Validation</strong> - Check template syntax before execution
- <strong>History</strong> - Track template usage</p>
<p><strong>Example Template:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>---
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>name: test-workflow
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="gu">description: Run all tests for {{project_type}} project</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="gu">---</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="gh"># Test Workflow for {{project_name}}</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>Based on project type: {{project_type}}
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>{{#if r-package}}
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>R CMD check --as-cran .
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>{{/if}}
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>{{#if python}}
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>pytest --cov={{project_name}}
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>{{/if}}
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>{{#if nodejs}}
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>npm test
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>{{/if}}
</code></pre></div></p>
<hr />
<h3 id="mcp-server-creation-workflow-phase-2">MCP Server Creation Workflow (Phase 2)</h3>
<pre class="mermaid"><code>flowchart TD
    Start([User: aiterm mcp create]) --&gt; Choose{Choose&lt;br/&gt;Template}

    Choose --&gt;|Server Type| Type[Statistical/Shell/Custom]
    Type --&gt; Name[Enter server name]
    Name --&gt; Tools{Include&lt;br/&gt;Tools?}

    Tools --&gt;|Yes| AddTools[Add tool definitions]
    Tools --&gt;|No| Skills

    AddTools --&gt; Skills{Include&lt;br/&gt;Skills?}

    Skills --&gt;|Yes| AddSkills[Add skill prompts]
    Skills --&gt;|No| Config

    AddSkills --&gt; Config[Generate config.json]
    Config --&gt; Structure[Create directory structure]

    Structure --&gt; Files{Generated&lt;br/&gt;Files}

    Files --&gt; F1[mcp-server/config.json]
    Files --&gt; F2[mcp-server/tools/]
    Files --&gt; F3[mcp-server/skills/]
    Files --&gt; F4[mcp-server/README.md]
    Files --&gt; F5[mcp-server/tests/]

    F1 --&gt; Validate[Validate structure]
    F2 --&gt; Validate
    F3 --&gt; Validate
    F4 --&gt; Validate
    F5 --&gt; Validate

    Validate --&gt; Test{Run&lt;br/&gt;Tests?}

    Test --&gt;|Yes| TestRun[aiterm mcp test server_name]
    Test --&gt;|No| Register

    TestRun --&gt; TestPass{Tests&lt;br/&gt;Pass?}
    TestPass --&gt;|No| Fix[Fix issues]
    Fix --&gt; TestRun
    TestPass --&gt;|Yes| Register

    Register[Register in settings.json] --&gt; Done([MCP Server Ready])

    style Start fill:#e1f5e1
    style Done fill:#e1f5e1
    style Choose fill:#fff4e6
    style Tools fill:#fff4e6
    style Skills fill:#fff4e6
    style Test fill:#fff4e6
    style TestPass fill:#fff4e6</code></pre>
<p><strong>MCP Creation Features (Phase 2):</strong>
- <strong>Interactive Wizard</strong> - Step-by-step guidance
- <strong>Template Library</strong> - Pre-built server templates
- <strong>Tool Generator</strong> - Auto-generate tool definitions
- <strong>Skill Prompts</strong> - Built-in skill templates
- <strong>Validation</strong> - Syntax and structure checks
- <strong>Testing</strong> - Automated testing before activation
- <strong>Registration</strong> - Auto-add to Claude Code settings</p>
<p><strong>Wizard Flow:</strong>
1. Choose server type (statistical, shell, custom)
2. Enter server name and description
3. Add tools (interactive or from template)
4. Add skills (optional)
5. Generate directory structure
6. Validate configuration
7. Run tests
8. Register in Claude Code settings</p>
<hr />
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>See <a href="../../api/AITERM-API/">API Documentation</a> for detailed API reference</li>
<li>See <a href="../../guides/AITERM-USER-GUIDE/">User Guide</a> for usage examples</li>
<li>See <a href="../../guides/AITERM-INTEGRATION/">Integration Guide</a> for custom integrations</li>
<li>See <a href="../../troubleshooting/AITERM-TROUBLESHOOTING/">Troubleshooting Guide</a> for common issues</li>
</ul>
<hr />
<p><strong>Last Updated:</strong> 2025-12-24
<strong>Maintained By:</strong> aiterm Development Team</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Data-Wise" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>